<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navbar</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
 <div class="navbar">
        <div class="logo"></div>
        <nav>
            <ul>
                <li><a href="#main-section">Home</a></li>
                <li><a href="#edit-transaction-section">Transactions</a></li>
                <li><a href="#reservation-section">Reservation</a></li>
                <li><a href="#container">Charts</a></li>
            </ul>
        </nav>
    </div>
 <!-- navbar in every page -->
 <!-- main page start -->
 <section id="main-section" class="page-section">
<table class="main-pagetable">
<tr>
<td>
    <div class="form-container">
        <form id="reservationForm">
            <div class="form-group">
                <label for="name">Name:</label>
                <input type="text" id="name" name="name" class="input-field" placeholder="Enter name" required>
            </div>
            <div class="form-group">
                <label for="time">Time:</label>
                <input type="time" id="time" name="time" class="input-field" required>
            </div>
            <div class="form-group">
                <label for="date">Date:</label>
                <input type="date" id="date" name="date" class="input-field" required>
            </div>
            <div class="form-group">
                <label for="table">Table:</label>
                <select id="table" name="table" class="input-field" required>
                    <option value="" disabled selected>Select a table</option>
                    <option value="table1">Table 1</option>
                    <option value="table2">Table 2</option>
                    <option value="table3">Table 3</option>
                    <option value="table4">Table 4</option>
                </select>
            </div>
            <div class="form-group">
                <label for="mobile_no">Mobile No:</label>
                <input type="text" id="mobile_no" name="mobile_no" class="input-field" placeholder="Enter mobile number" required>
            </div>
            <div class="form-group">
                <button type="button" id="checkAvailability" class="check-btn">Check Availability</button>
            </div>
            <div class="form-group">
                <button type="submit" id="addReservation" class="add-btn" disabled>Add Reservation</button>
            </div>
        </form>
    </div>
</td>
<td>
    <div class="total-box">
        <h3>Total</h3>
        <div>
            <label for="total-revenue">Revenue:</label>
            <textarea id="total-revenue" readonly></textarea>
        </div>
        <div>
            <label for="total-clients">Clients:</label>
            <textarea id="total-clients" readonly></textarea>
        </div>
    </div>
</td>
</tr>
<tr>
    <td rowspan="2">
    <div class="transaction-form-section">
        <h3>New Transaction:</h3>
        <form>
            <div class="transaction-form-group">
                <label for="transaction-id">ID :</label>
                <input type="text" id="transaction-id" class="transaction-input-field">
            </div>
            <div class="transaction-form-group">
                <label for="transaction-name">Name :</label>
                <input type="text" id="transaction-name" class="transaction-input-field">
            </div>
            <div class="transaction-form-group">
                <label for="transaction-amount">Amount :</label>
                <input type="number" id="transaction-amount" class="transaction-input-field">
            </div>
            <div class="transaction-form-group">
                <label for="transaction-time">Time :</label>
                <input type="time" id="transaction-time" class="transaction-input-field">
            </div>
            <div class="transaction-form-group">
                <label for="transaction-date">Date :</label>
                <input type="date" id="transaction-date" class="transaction-input-field">
            </div>
            <div class="transaction-form-buttons">
                <button type="submit" class="transaction-btn">Add</button>
                <button type="reset" class="transaction-btn">clear</button>
            </div>
        </form>
    </div>
</td>


<td>
    <div class="today-layout">
    <div class="today-box">
        <h3>Today</h3>
        <div>
            <label for="today-revenue">Revenue:</label>
            <textarea id="today-revenue" readonly></textarea>
        </div>
        <div>
            <label for="today-clients">Clients:</label>
            <textarea id="today-clients" readonly></textarea>
        </div>
    </div>
</div>
</td>
</tr>
</table>
 </section>
<!-- main page end -->
 <!-- transaction page start -->
 <section id="edit-transaction-section" class="page-section">
    <div class="edit-transaction-section" id="edit-transaction-section">
        <form>
            <div class="edit-transaction-group">
                <label for="edit-transaction-id">Enter name:</label>
                <input type="text" id="edit-transaction-id" class="edit-transaction-input"required>
                <button type="button" class="edit-transaction-btn search-btn">Search</button>
            </div>
        </form>
      </div>
      <div class="search-results-section">
        <h3>Search Results</h3>
        <table class="transaction-table">
            <thead>
                <tr>
                    <th>id</th>
                    <th>Name</th>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Amount</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="search-results">
                <!-- Data will be populated by JavaScript -->
            </tbody>
        </table>
      </div>  
      <!-- Form for Updating and Deleting Transactions -->
   <div class="update-transaction-section" id="update-transaction-section">
    <div class="update-transaction-content">
        <span class="close" id="close-btn">&times;</span>
        <h3>Update Transaction</h3>
        <form id="update-form" method="POST" action="update_delete_transaction.php">
            <div class="update-transaction-group">
                <label for="update-transaction-id">ID:</label>
                <input type="text" id="update-transaction-id" name="transaction_id" class="update-transaction-input" readonly>
            </div>
            <div class="update-transaction-group">
                <label for="update-transaction-name">Name:</label>
                <input type="text" id="update-transaction-name" name="transaction_name" class="update-transaction-input">
            </div>
            <div class="update-transaction-group">
                <label for="update-transaction-date">Date:</label>
                <input type="date" id="update-transaction-date" name="transaction_date" class="update-transaction-input">
            </div>
            <div class="update-transaction-group">
                <label for="update-transaction-time">Time:</label>
                <input type="time" id="update-transaction-time" name="transaction_time" class="update-transaction-input">
            </div>
            <div class="update-transaction-group">
                <label for="update-transaction-amount">Amount:</label>
                <input type="number" id="update-transaction-amount" name="transaction_amount" class="update-transaction-input">
            </div>
            <div class="update-transaction-buttons">
                <button type="submit" name="action" value="delete" class="update-transaction-btn delete-btn" id="delete-btn">Delete</button>
                <button type="submit" name="action" value="update" class="update-transaction-btn update-btn" id="update-btn">Update</button>
            </div>
        </form>
    </div>
  </div>  
<div class="transactions-today">
    <h3>Today Transaction</h3>
    <table class="transaction-table">
        <thead>
            <tr>
                <th>id</th>
                <th>Name</th>
                <th>Date</th>
                <th>Time</th>
                <th>Amount</th>
            </tr>
        </thead>
        <tbody>
            <!-- Add your rows here -->
        </tbody>
    </table>
</div>

<div class="transactions-week">
    <h3>This week Transactions</h3>
    <table class="transaction-table">
        <thead>
            <tr>
                <th>id</th>
                <th>Name</th>
                <th>Date</th>
                <th>Time</th>
                <th>Amount</th>
            </tr>
        </thead>
        <tbody>
            <!-- Add your rows here -->
        </tbody>
    </table>
</div>
</section>
 <!-- transaction page end -->
   <!-- reservation page start -->
<section id="reservation-section" class="page-section">
    <div class="reservation-section" name="reservation-section" id="reservation-section">
        <form>
            <h3 class="section-title">Enter Name:</h3>
            <div class="input-group">
                <input type="text" id="searchName" class="input-reservation" placeholder="Enter Name">
                <button type="button" id="searchBtn" class="btn-reservation-search">Search</button>
            </div>
        </form>
       </div>

       <div class="reservation-table-section">
        <h3>Search Results</h3>
        <table class="reservation-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Table No</th>
                    <th>Mobile No</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="searchResults">
                <!-- Search results data will be populated here -->
            </tbody>
        </table>
       </div>     

<div class="reservation-table-section">
    <h3>Today Reservations</h3>
    <table class="reservation-table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Date</th>
                <th>Time</th>
            </tr>
        </thead>
        <tbody>
            <!-- Add your rows here -->
        </tbody>
    </table>
</div>
<div class="reservation-table-section">
    <h3>Tomorrow's Reservations</h3>
    <table class="reservation-table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Date</th>
                <th>Time</th>
                <th>Table No</th>
                <th>Mobile No</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="tomorrowReservations">
            <!-- Tomorrow's reservation data will be populated here -->
        </tbody>
    </table>
  </div>
</section>
 <!-- reservation page end --> 
  <!-- summary page start -->
  <section id="container" class="page-section">
<div class="container" id="container" name="container" >
    <div class="chart" id="chart1">
        <div class="heading">No of People Visited Yearly</div>
        <canvas id="barChart1"></canvas>
    </div>
    <div class="chart" id="chart2">
        <div class="heading">Total Monthly Cash Flow</div>
        <canvas id="barChart2"></canvas>
    </div>
    <div class="chart" id="chart3">
        <div class="heading">Total Yearly Cash Flow</div>
        <canvas id="barChart3"></canvas>
    </div>
</div>
</section>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>

const ctx1 = document.getElementById('barChart1').getContext('2d');
   const barChart1 = new Chart(ctx1, {
        type: 'bar',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            datasets: [{
                label: 'No of people visited yearly',
                data: [120, 150, 180, 220, 160, 200, 240, 300, 280, 320, 310, 330],
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

   const ctx2 = document.getElementById('barChart2').getContext('2d');
   const barChart2 = new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            datasets: [{
                label: 'Total Monthly cash flow',
                data: [1000, 1500, 1800, 2200, 2600, 2800, 3000, 3500, 3200, 3100, 3300, 3700],
                backgroundColor: 'rgba(153, 102, 255, 0.2)',
                borderColor: 'rgba(153, 102, 255, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

   const ctx3 = document.getElementById('barChart3').getContext('2d');
    const barChart3 = new Chart(ctx3, {
        type: 'bar',
        data: {
            labels: ['Year 1', 'Year 2', 'Year 3', 'Year 4', 'Year 5'],
            datasets: [{
                label: 'Total yearly cash flow',
                data: [12000, 15000, 18000, 22000, 26000],
                backgroundColor: 'rgba(255, 159, 64, 0.2)',
                borderColor: 'rgba(255, 159, 64, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
   });
   document.addEventListener("DOMContentLoaded", function () {
    const sections = document.querySelectorAll(".page-section");
    const navLinks = document.querySelectorAll(".navbar a");

    function showSection(sectionId) {
        sections.forEach(section => {
            if (section.id === sectionId) {
                section.style.display = "block";
            } else {
                section.style.display = "none";
            }
        });
    }

    navLinks.forEach(link => {
        link.addEventListener("click", function (event) {
            event.preventDefault();
            const targetId = this.getAttribute("href").substring(1);
            showSection(targetId);
        });
    });
});
document.addEventListener('DOMContentLoaded', function() {
    // Function to generate a unique transaction ID
    function generateTransactionId() {
        return 'TXN-' + Math.floor(Math.random() * 1000000);
    }

    var transactionIdInput = document.getElementById('transaction-id');
    
    // Generate and set a new transaction ID on page load
    transactionIdInput.value = generateTransactionId();

    // Set current date and time
    function setCurrentDateTime() {
        var now = new Date();
        var dateString = now.toISOString().split('T')[0]; // Format: YYYY-MM-DD
        var timeString = now.toTimeString().split(' ')[0].substring(0, 5); // Format: HH:MM

        document.getElementById('transaction-date').value = dateString;
        document.getElementById('transaction-time').value = timeString;
    }

    setCurrentDateTime();

    // Handle form submission
    document.getElementById('transactionForm').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent the default form submission

        var formData = new FormData(this);

        fetch('transactions.php', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                alert(data.message);
                // Regenerate a new ID for the next transaction
                transactionIdInput.value = generateTransactionId();
                // Reset the form and set the date and time
                document.getElementById('transactionForm').reset();
                setCurrentDateTime();
                // Set a new ID after form reset
                transactionIdInput.value = generateTransactionId();
            } else {
                alert(data.message);
            }
        })
        .catch(error => {
            alert('An error occurred: ' + error);
        });
    });
});

document.addEventListener('DOMContentLoaded', function() {
    const updateSection = document.getElementById('update-transaction-section');
    const closeButton = document.getElementById('close-btn');
    const updateButton = document.getElementById('update-btn');
    const deleteButton = document.getElementById('delete-btn');
    const searchButton = document.querySelector('.search-btn');
    const searchInput = document.getElementById('edit-transaction-id');
    const searchResultsTable = document.getElementById('search-results');

    function setupEditButtons(tableId) {
        const editButtons = document.querySelectorAll(`#${tableId} .edit-btn`);
        
        editButtons.forEach(button => {
            button.addEventListener('click', function() {
                const row = this.closest('tr');
                const id = row.getAttribute('data-id');
                const name = row.children[1].innerText;
                const date = row.children[2].innerText;
                const time = row.children[3].innerText;
                const amount = row.children[4].innerText;
    
                document.getElementById('update-transaction-id').value = id;
                document.getElementById('update-transaction-name').value = name;
                document.getElementById('update-transaction-date').value = date;
                document.getElementById('update-transaction-time').value = time;
                document.getElementById('update-transaction-amount').value = amount;
    
                updateSection.style.display = 'flex'; // Show the dialog box
            });
        });
    }

    function setupDeleteButton() {
        deleteButton.addEventListener('click', function(event) {
            event.preventDefault(); // Prevent default form submission

            const id = document.getElementById('update-transaction-id').value;

            if (confirm('Are you sure you want to delete this transaction?')) {
                fetch('update_delete_transaction.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        action: 'delete',
                        transaction_id: id
                    })
                })
                .then(response => response.text())
                .then(result => {
                    if (result.includes('successfully')) {
                        alert('Deleted successfully!');
                        updateSection.style.display = 'none'; // Hide dialog box
                        loadTransactions('today', 'today-transactions');
                        loadTransactions('week', 'week-transactions');
                        searchTransactions(); // Refresh search results
                    } else {
                        alert('Delete failed: ' + result);
                    }
                })
                .catch(error => {
                    alert('Delete error: ' + error);
                });
            }
        });
    }

    function loadTransactions(filter, tableId) {
        fetch(`fetch_transactions.php?filter=${filter}`)
            .then(response => response.json())
            .then(data => {
                const tableBody = document.getElementById(tableId);
                tableBody.innerHTML = '';
                if (data.length > 0) {
                    data.forEach(transaction => {
                        const row = document.createElement('tr');
                        row.setAttribute('data-id', transaction.transaction_id);
                        row.innerHTML = `
                            <td>${transaction.transaction_id}</td>
                            <td>${transaction.transaction_name}</td>
                            <td>${transaction.transaction_date}</td>
                            <td>${transaction.transaction_time}</td>
                            <td>${transaction.transaction_amount}</td>
                            <td><button class='edit-btn'>Edit</button></td>
                        `;
                        tableBody.appendChild(row);
                    });
                } else {
                    tableBody.innerHTML = '<tr><td colspan="6">No transactions found</td></tr>';
                }
                setupEditButtons(tableId);
            });
    }

    function searchTransactions() {
        const name = searchInput.value.trim();
        fetch(`fetch_transactions.php?name=${name}`)
            .then(response => response.json())
            .then(data => {
                searchResultsTable.innerHTML = ''; // Clear previous results
                if (data.length > 0) {
                    data.forEach(transaction => {
                        const row = document.createElement('tr');
                        row.setAttribute('data-id', transaction.transaction_id);
                        row.innerHTML = `
                            <td>${transaction.transaction_id}</td>
                            <td>${transaction.transaction_name}</td>
                            <td>${transaction.transaction_date}</td>
                            <td>${transaction.transaction_time}</td>
                            <td>${transaction.transaction_amount}</td>
                            <td><button class='edit-btn'>Edit</button></td>
                        `;
                        searchResultsTable.appendChild(row);
                    });
                } else {
                    searchResultsTable.innerHTML = '<tr><td colspan="6">No transactions found</td></tr>';
                }
                setupEditButtons('search-results');
            });
    }

    // Load transactions when the page loads
    loadTransactions('today', 'today-transactions');
    loadTransactions('week', 'week-transactions');

    // Close button functionality
    closeButton.addEventListener('click', function() {
        updateSection.style.display = 'none'; // Hide the dialog box
    });

    // Update button functionality
    updateButton.addEventListener('click', function(event) {
        event.preventDefault();
        const id = document.getElementById('update-transaction-id').value;
        const name = document.getElementById('update-transaction-name').value;
        const date = document.getElementById('update-transaction-date').value;
        const time = document.getElementById('update-transaction-time').value;
        const amount = document.getElementById('update-transaction-amount').value;

        fetch('update_delete_transaction.php', { 
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                action: 'update',
                transaction_id: id,
                transaction_name: name,
                transaction_date: date,
                transaction_time: time,
                transaction_amount: amount
            })
        })
        .then(response => response.text())
        .then(result => {
            if (result.includes('successfully')) {
                alert('Updated successfully!');
                loadTransactions('today', 'today-transactions');
                loadTransactions('week', 'week-transactions');
                updateSection.style.display = 'none'; // Hide the dialog box after update
                searchTransactions(); // Refresh search results
            } else {
                alert('Update failed: ' + result);
            }
        })
        .catch(error => {
            alert('Update error: ' + error);
        });
    });

    // Search button functionality
    searchButton.addEventListener('click', function() {
        searchTransactions();
    });

    // Set up delete button
    setupDeleteButton();
});
</script>

</body>
</html>
